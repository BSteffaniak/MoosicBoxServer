{"version":3,"file":"auth.BCKa92c7.js","sources":["../../../src/routes/auth.tsx"],"sourcesContent":["import { Show, createSignal, onMount } from 'solid-js';\nimport {\n    api,\n    connection,\n    getNewConnectionId,\n    setConnection,\n    type Connection,\n} from '~/services/api';\nimport { getQueryParam } from '~/services/util';\n\nexport default function authPage() {\n    const magicTokenParam = getQueryParam('magicToken');\n    const apiUrlParam = getQueryParam('apiUrl');\n\n    const [loading, setLoading] = createSignal(true);\n    const [error, setError] = createSignal<string>();\n\n    function saveConnection(values: Partial<Connection>) {\n        const con = connection.get();\n        const id = con?.id ?? getNewConnectionId();\n        setConnection(id, values);\n    }\n\n    onMount(async () => {\n        if (!magicTokenParam) {\n            setLoading(false);\n            setError('No magic token');\n            return;\n        }\n\n        if (apiUrlParam) {\n            saveConnection({\n                apiUrl: apiUrlParam,\n            });\n        }\n\n        const resp = await api.magicToken(magicTokenParam);\n        setLoading(false);\n\n        if (resp) {\n            saveConnection({\n                clientId: resp.clientId,\n                token: resp.accessToken,\n            });\n            window.location.href = '/';\n        } else {\n            setError('Failed to authenticate with magic token');\n        }\n    });\n\n    return (\n        <div>\n            {loading() ? (\n                <>Loading...</>\n            ) : (\n                <>\n                    <Show when={error()}>{error()}</Show>\n                </>\n            )}\n        </div>\n    );\n}\n"],"names":["authPage","magicTokenParam","getQueryParam","apiUrlParam","loading","setLoading","createSignal","error","setError","saveConnection","values","id","connection","get","getNewConnectionId","setConnection","onMount","apiUrl","resp","api","magicToken","clientId","token","accessToken","window","location","href","_el$","_$getNextElement","_tmpl$","_$insert","_c$","_$memo","_$createComponent","Show","when","children"],"mappings":"0KAUA,SAAwBA,GAAW,CACzBC,MAAAA,EAAkBC,EAAc,YAAY,EAC5CC,EAAcD,EAAc,QAAQ,EAEpC,CAACE,EAASC,CAAU,EAAIC,EAAa,EAAI,EACzC,CAACC,EAAOC,CAAQ,EAAIF,EAAqB,EAE/C,SAASG,EAAeC,EAA6B,CAE3CC,MAAAA,EADMC,EAAWC,OACPF,IAAMG,EAAmB,EACzCC,EAAcJ,EAAID,CAAM,CAC5B,CAEAM,OAAAA,EAAQ,SAAY,CAChB,GAAI,CAACf,EAAiB,CAClBI,EAAW,EAAK,EAChBG,EAAS,gBAAgB,EACzB,MACJ,CAEIL,GACeM,EAAA,CACXQ,OAAQd,CAAAA,CACX,EAGL,MAAMe,EAAO,MAAMC,EAAIC,WAAWnB,CAAe,EACjDI,EAAW,EAAK,EAEZa,GACeT,EAAA,CACXY,SAAUH,EAAKG,SACfC,MAAOJ,EAAKK,WAAAA,CACf,EACDC,OAAOC,SAASC,KAAO,KAEvBlB,EAAS,yCAAyC,CACtD,CACH,GAED,IAAA,CAAAmB,IAAAA,EAAAC,EAAAC,CAAA,EAAAC,OAAAA,EAAAH,GAAA,IAAA,CAAA,IAAAI,EAAAC,EAES5B,IAAAA,CAAAA,CAAAA,EAAS,CAAA,EAAA,MAAA,IAAT2B,EAAA,EAAA,aAAAE,EAIQC,EAAI,CAAA,IAACC,MAAI,CAAA,OAAE5B,EAAM,CAAC,EAAA,IAAA6B,UAAA,CAAA,OAAG7B,EAAM,CAAC,CAAA,CAEpC,KAAA,EAAAoB,CAAAA,IAGb"}