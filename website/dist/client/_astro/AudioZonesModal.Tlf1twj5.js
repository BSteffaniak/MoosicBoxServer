import{d as $e,c as O,h as Ce,g as r,a as $,i as l,b as z,f as M,k as K,r as y,I as W,e as ae,u as we,s as ke,t as u,l as Pe}from"./web.o2PnP_jd.js";import{p as se,I as Oe,J as q,H as ue,C as me,D as N,K as B,v as le,G as Ne}from"./ChangePlaybackTargetModal.BU1Vz2Zf.js";import{c as pe,p as E,a as de}from"./api.DZqBGp_p.js";/* empty css                        */var Ee=u("<div class=audio-zones><div class=audio-zones-list-modal-content><!$><!/><!$><!/><!$><!/>"),Te=u('<div><h2 class=audio-zones-list-zone-header></h2><div class=audio-zone-audio-zone-modal-audio-zone-player><img class=audio-icon src=/img/audio-white.svg alt="Zone Player"> <!$><!/> - <!$><!/>'),Ue=u('<div><h2 class=audio-zones-list-zone-header><!$><!/><div class=audio-zones-list-zone-header-right><div class=audio-zones-list-zone-header-delete-zone><img class=trash-icon src=/img/trash-white.svg alt="Delete playback session"></div></div></h2><!$><!/><button class="remove-button-styles audio-zone-audio-zone-modal-audio-zone-player add-players"><img class=plus-icon src=/img/plus-white.svg alt="Add players to audio zone"> Add players'),je=u("<input autofocus type=text>"),De=u('<button class="remove-button-styles audio-zones-list-zone-header-submit-edit-name"><img class=audio-zones-list-zone-header-submit-edit-name-icon src=/img/checkmark-white.svg alt="Submit audio zone name">'),Me=u('<button class="remove-button-styles audio-zones-list-zone-header-edit-name"><img class=audio-zones-list-zone-header-edit-name-icon src=/img/pencil-white.svg alt="Edit audio zone name">'),We=u('<div class=audio-zone-audio-zone-modal-audio-zone-player><img class=audio-icon src=/img/audio-white.svg alt="Zone Player"> <!$><!/> - <!$><!/>'),Fe=u('<div class=audio-zone-active-players-modal-container><div class=audio-zone-active-players-modal-header><h1><!$><!/> - Active Players</h1><div class=audio-zone-active-players-modal-header-close><img class=cross-icon src=/img/cross-white.svg alt="Close playlist sessions modal"></div></div><div class=audio-zone-active-players-modal-content>'),He=u("<div>"),Re=u("<div><!$><!/> - <!$><!/> <!$><!/>"),Ge=u('<img class=audio-icon src=/img/audio-white.svg alt="Player enabled">'),Je=u('<img class=audio-icon src=/img/audio-off-white.svg alt="Player disabled">');function Ke(){let Z;const[L,A]=O([]),[C,F]=O([]),[Q,H]=O(se.currentAudioZone),[b,T]=O(),[V,U]=O(),[ce]=pe(Oe),[ge,_e]=O([]);function ve(){const e=q.connection;return console.log(e),e?.players?.map(i=>({...i,connection:e}))??[]}function X(){const e=q.connections;return se.audioZones.map(i=>({...i,players:i.players.map(o=>({...o,connection:e.find(a=>a.players?.find(S=>S.playerId===o.playerId))}))}))}Ce(()=>{A(ve()),F(X()),H(se.currentAudioZone);const e=q.connections.filter(a=>a.alive),i=q.connections.filter(a=>!a.alive),n=e.filter(a=>a.connectionId==ce()),o=e.filter(a=>a.connectionId!=ce());_e([...n,...o,...i])});function he(e){N(E(i=>{i.currentAudioZone=void 0;const n=e.connection?.connectionId;n&&B({type:"CONNECTION_OUTPUT",connectionId:n,outputId:e.audioOutputId})}))}function ye(e){N(E(i=>{i.currentAudioZone=e,B({type:"AUDIO_ZONE",audioZoneId:e.id})}))}async function R(e){return N(E(i=>{i.currentAudioZone?.id===e.id&&Object.assign(i.currentAudioZone,e);const n=i.audioZones.find(o=>o.id===e.id);n&&Object.assign(n,{name:e.name??n.name})})),await de.updateAudioZone(e)}async function be(e){let i;N(E(n=>{if(e.id===n.currentAudioZone?.id){const o=n.audioZones[0];n.currentAudioZone=o,o?B({type:"AUDIO_ZONE",audioZoneId:o.id}):B(void 0)}i=n.audioZones.findIndex(o=>o.id===e.id),n.audioZones.splice(i,1)})),await de.deleteAudioZone(e.id)}function re(e,i){N(E(n=>{n.currentAudioZone?.id===e.id&&Object.assign(n.currentAudioZone,i);const o=n.audioZones.find(a=>a.id===e.id);o&&Object.assign(o,i)}))}async function fe(e,i){const n=e.players.filter(c=>c.playerId!==i.playerId).map(({playerId:c})=>c),o={id:e.id,players:n},a=await R(o);re(e,a);const S=X();U(S.find(c=>c.id===a.id))}async function ze(e,i){const n=[...e.players.filter(c=>c.playerId!==i.playerId),i].map(({playerId:c})=>c),o={id:e.id,players:n},a=await R(o);re(e,a);const S=X();U(S.find(c=>c.id===a.id))}return(()=>{var e=r(Ee),i=e.firstChild,n=i.firstChild,[o,a]=$(n.nextSibling),S=o.nextSibling,[c,Se]=$(S.nextSibling),xe=c.nextSibling,[Ie,Ze]=$(xe.nextSibling);return l(i,z(W,{get each(){return L()},children:t=>(()=>{var m=r(Te),p=m.firstChild,v=p.nextSibling,w=v.firstChild,k=w.nextSibling,j=k.nextSibling,[P,D]=$(j.nextSibling),_=P.nextSibling,x=_.nextSibling,[h,d]=$(x.nextSibling);return p.$$click=()=>he(t()),l(p,()=>t().name),l(v,()=>t().connection?.name,P,D),l(v,()=>t().name,h,d),M(()=>K(m,`audio-zones-list-zone${ue()?.type==="CONNECTION_OUTPUT"&&t().audioOutputId===ue().outputId?" active":""}`)),y(),m})()}),o,a),l(i,z(W,{get each(){return C()},children:t=>(()=>{var m=r(Ue),p=m.firstChild,v=p.firstChild,[w,k]=$(v.nextSibling),j=w.nextSibling,P=j.firstChild,D=p.nextSibling,[_,x]=$(D.nextSibling),h=_.nextSibling;return p.$$click=()=>ye(t()),l(p,(()=>{var d=ae(()=>b()?.id===t().id);return()=>d()?[(()=>{var s=r(je);s.$$keyup=async f=>{f.key==="Enter"&&(f.stopImmediatePropagation(),b().name=Z.value,await R(b()),T(void 0))},s.$$click=f=>f.stopImmediatePropagation();var g=Z;return typeof g=="function"?we(g,s):Z=s,M(()=>ke(s,"value",b().name??"")),y(),s})(),(()=>{var s=r(De);return s.$$click=async g=>{g.stopImmediatePropagation(),b().name=Z.value,await R(b()),T(void 0)},y(),s})()]:[ae(()=>t().name),(()=>{var s=r(Me);return s.$$click=g=>{g.stopImmediatePropagation(),T({id:t().id,name:t().name})},y(),s})()]})(),w,k),P.$$click=async d=>{d.stopImmediatePropagation(),await be(t())},l(m,z(W,{get each(){return t().players},children:d=>(()=>{var s=r(We),g=s.firstChild,f=g.nextSibling,Y=f.nextSibling,[G,J]=$(Y.nextSibling),ee=G.nextSibling,ie=ee.nextSibling,[ne,oe]=$(ie.nextSibling);return l(s,()=>d().connection?.name,G,J),l(s,()=>d().name,ne,oe),s})()}),_,x),h.$$click=d=>{d.stopImmediatePropagation(),U(t())},M(()=>K(m,`audio-zones-list-zone${t().id===Q()?.id?" active":""}`)),y(),m})()}),c,Se),l(i,z(me,{show:()=>V(),onClose:()=>U(void 0),class:"audio-zone-active-players-modal",children:t=>(()=>{var m=r(Fe),p=m.firstChild,v=p.firstChild,w=v.firstChild,[k,j]=$(w.nextSibling);k.nextSibling;var P=v.nextSibling,D=p.nextSibling;return l(v,()=>t.name,k,j),P.$$click=_=>{U(void 0),_.stopImmediatePropagation()},l(D,z(W,{get each(){return ge()},children:_=>(()=>{var x=r(He);return l(x,z(W,{get each(){return _().players},children:h=>(()=>{var d=r(Re),s=d.firstChild,[g,f]=$(s.nextSibling),Y=g.nextSibling,G=Y.nextSibling,[J,ee]=$(G.nextSibling),ie=J.nextSibling,ne=ie.nextSibling,[oe,Ae]=$(ne.nextSibling);return l(d,()=>_().name,g,f),l(d,()=>h().name,J,ee),l(d,(()=>{var te=ae(()=>!!t.players.some(I=>I.playerId===h().playerId));return()=>te()?(()=>{var I=r(Ge);return I.$$click=()=>fe(t,h()),y(),I})():(()=>{var I=r(Je);return I.$$click=()=>ze(t,h()),y(),I})()})(),oe,Ae),M(()=>K(d,`audio-zone-active-players-modal-connection-player${t.players.some(te=>te.playerId===h().playerId)?" active":""}`)),d})()})),M(()=>K(x,`audio-zone-active-players-modal-connection${_().alive?" alive":" dead"}`)),x})()})),y(),m})()}),Ie,Ze),e})()}$e(["click","keyup"]);var qe=u('<div class=audio-zones-modal-container><div class=audio-zones-modal-header><h1>Audio Zones</h1><button class=playback-sessions-modal-header-new-button>New</button><div class=audio-zones-modal-close><img class=cross-icon src=/img/cross-white.svg alt="Close audio zones modal"></div></div><div class=audio-zones-modal-content>'),Be=u("<div data-turbo-permanent id=audio-zones-modal>");function Ye(){Pe(async()=>{await Ne()});const[Z]=pe(le);async function L(){const A=await de.createAudioZone("Custom Zone");N(E(C=>{C.audioZones.push(A)}))}return(()=>{var A=r(Be);return l(A,z(me,{show:()=>Z(),onClose:()=>le.set(!1),get children(){var C=r(qe),F=C.firstChild,Q=F.firstChild,H=Q.nextSibling,b=H.nextSibling,T=F.nextSibling;return H.$$click=async()=>await L(),b.$$click=V=>{le.set(!1),V.stopImmediatePropagation()},l(T,z(Ke,{})),y(),C}})),A})()}$e(["click"]);export{Ye as default};
//# sourceMappingURL=AudioZonesModal.Tlf1twj5.js.map
