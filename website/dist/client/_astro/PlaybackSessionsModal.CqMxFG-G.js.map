{"version":3,"file":"PlaybackSessionsModal.CqMxFG-G.js","sources":["../../../src/components/PlaybackSessions/PlaybackSessions.tsx","../../../src/components/PlaybackSessionsModal/PlaybackSessionsModal.tsx"],"sourcesContent":["import './playback-sessions.css';\nimport { For, Index, createComputed, createSignal } from 'solid-js';\nimport { Api } from '~/services/api';\nimport type { Track } from '~/services/api';\nimport { playerState, setPlayerState, updateSession } from '~/services/player';\nimport Album from '../Album';\nimport { produce } from 'solid-js/store';\nimport { wsService } from '~/services/ws';\n\nconst queuedTracksCache: {\n    [id: number]: { position?: number; tracks: Track[] };\n} = {};\n\nexport default function playbackSessionsFunc() {\n    const [sessions, setSessions] = createSignal<Api.PlaybackSession[]>(\n        playerState.playbackSessions,\n    );\n    const [audioZoneSession, setAudioZoneSession] =\n        createSignal<Api.PlaybackSession>();\n\n    createComputed(() => {\n        setSessions(playerState.playbackSessions);\n\n        if (audioZoneSession()) {\n            setAudioZoneSession(\n                sessions().find(\n                    (s) => s.sessionId === audioZoneSession()?.sessionId,\n                ),\n            );\n        }\n    });\n\n    function deleteSession(sessionId: number) {\n        if (sessionId === playerState.currentPlaybackSession?.sessionId) {\n            setPlayerState(\n                produce((state) => {\n                    state.playbackSessions.find(\n                        (s) => s.sessionId === sessionId,\n                    );\n                    setSessions(\n                        sessions().filter((s) => s.sessionId !== sessionId),\n                    );\n                    const newSession = sessions()[0];\n                    if (newSession) {\n                        updateSession(state, newSession, true);\n                    }\n                }),\n            );\n        }\n        wsService.deleteSession(sessionId);\n    }\n\n    function activateSession(session: Api.PlaybackSession) {\n        if (session.sessionId === playerState.currentPlaybackSession?.sessionId)\n            return;\n        setPlayerState(\n            produce((state) => {\n                updateSession(state, session, true);\n            }),\n        );\n    }\n\n    function queuedTracks(session: Api.PlaybackSession) {\n        const cache = queuedTracksCache[session.sessionId];\n\n        if (\n            cache?.position === session.position &&\n            cache?.tracks.every((t, i) => {\n                const track = session.playlist.tracks[i];\n\n                if (!track) {\n                    console.error('Failed to queue tracks');\n                    return undefined;\n                }\n\n                return (\n                    ('trackId' in track &&\n                        'trackId' in t &&\n                        track.trackId === t?.trackId) ||\n                    ('id' in track && 'id' in t && track.id === t?.id)\n                );\n            })\n        ) {\n            return cache.tracks;\n        }\n\n        const tracks = session.playlist.tracks.slice(\n            session.position ?? 0,\n            session.playlist.tracks.length,\n        );\n        queuedTracksCache[session.sessionId] = {\n            position: session.position!,\n            tracks,\n        };\n\n        return tracks;\n    }\n\n    return (\n        <div class=\"playback-sessions\">\n            <div class=\"playback-sessions-list\">\n                <For each={playerState.playbackSessions}>\n                    {(session) => (\n                        <div\n                            class={`playback-sessions-list-session${\n                                playerState.currentPlaybackSession\n                                    ?.sessionId === session.sessionId\n                                    ? ' active'\n                                    : ''\n                            }`}\n                        >\n                            <div\n                                class=\"playback-sessions-list-session-header\"\n                                onClick={() => activateSession(session)}\n                            >\n                                <img\n                                    class=\"playback-sessions-list-session-header-speaker-icon\"\n                                    src=\"/img/speaker-white.svg\"\n                                />\n                                <h2 class=\"playback-sessions-list-session-header-session-name\">\n                                    {session.name}\n                                </h2>\n                                <h3 class=\"playback-sessions-list-session-header-session-tracks-queued\">\n                                    {queuedTracks(session).length} track\n                                    {queuedTracks(session).length === 1\n                                        ? ''\n                                        : 's'}{' '}\n                                    queued\n                                </h3>\n                                {playerState.currentPlaybackSession\n                                    ?.sessionId === session.sessionId && (\n                                    <>\n                                        <img\n                                            class=\"playback-sessions-list-session-header-checkmark-icon\"\n                                            src=\"/img/checkmark-white.svg\"\n                                        />\n                                    </>\n                                )}\n                                {session.playing && (\n                                    <img\n                                        class=\"playback-sessions-list-session-header-playing-icon\"\n                                        src=\"/img/audio-white.svg\"\n                                    />\n                                )}\n                                <div class=\"playback-sessions-list-session-header-right\">\n                                    <div\n                                        class=\"playback-sessions-list-session-header-delete-session\"\n                                        onClick={(e) => {\n                                            deleteSession(session.sessionId);\n                                            e.stopImmediatePropagation();\n                                        }}\n                                    >\n                                        <img\n                                            class=\"trash-icon\"\n                                            src=\"/img/trash-white.svg\"\n                                            alt=\"Delete playback session\"\n                                        />\n                                    </div>\n                                </div>\n                            </div>\n                            <div class=\"playback-sessions-playlist-tracks-container\">\n                                <div class=\"playback-sessions-playlist-tracks\">\n                                    <Index each={queuedTracks(session)}>\n                                        {(track, index) =>\n                                            index >= 4 ? (\n                                                <></>\n                                            ) : (\n                                                <div class=\"playback-sessions-playlist-tracks-track\">\n                                                    <div class=\"playback-sessions-playlist-tracks-track-album-artwork\">\n                                                        <div class=\"playback-sessions-playlist-tracks-track-album-artwork-icon\">\n                                                            <Album\n                                                                album={track()}\n                                                                size={40}\n                                                                route={false}\n                                                            />\n                                                        </div>\n                                                    </div>\n                                                    <div class=\"playback-sessions-playlist-tracks-track-details\">\n                                                        <div class=\"playback-sessions-playlist-tracks-track-details-title\">\n                                                            {track().title}\n                                                        </div>\n                                                        <div class=\"playback-sessions-playlist-tracks-track-details-artist\">\n                                                            {track().artist}\n                                                        </div>\n                                                    </div>\n                                                </div>\n                                            )\n                                        }\n                                    </Index>\n                                </div>\n                                {queuedTracks(session).length >= 3 && (\n                                    <div class=\"playback-sessions-playlist-tracks-overlay\"></div>\n                                )}\n                            </div>\n                        </div>\n                    )}\n                </For>\n            </div>\n        </div>\n    );\n}\n","import './playback-sessions-modal.css';\nimport Modal from '../Modal';\nimport PlaybackSessions from '../PlaybackSessions';\nimport { currentPlaybackTarget } from '~/services/player';\nimport { showPlaybackSessions, triggerStartup } from '~/services/app';\nimport { clientSignal } from '~/services/util';\nimport { onMount } from 'solid-js';\nimport { wsService } from '~/services/ws';\n\nexport default function playbackSessionsModalFunc() {\n    onMount(async () => {\n        await triggerStartup();\n    });\n    const [$showPlaybackSessions] = clientSignal(showPlaybackSessions);\n\n    function createNewSession() {\n        wsService.createSession({\n            name: 'New Session',\n            playlist: {\n                tracks: [],\n            },\n            playbackTarget: currentPlaybackTarget(),\n        });\n    }\n\n    return (\n        <div data-turbo-permanent id=\"playback-sessions-modal\">\n            <Modal\n                show={() => $showPlaybackSessions()}\n                onClose={() => showPlaybackSessions.set(false)}\n            >\n                <div class=\"playback-sessions-modal-container\">\n                    <div class=\"playback-sessions-modal-header\">\n                        <h1>Playback Sessions</h1>\n                        <button\n                            class=\"playback-sessions-modal-header-new-button\"\n                            onClick={() => createNewSession()}\n                        >\n                            New\n                        </button>\n                        <div\n                            class=\"playback-sessions-modal-close\"\n                            onClick={(e) => {\n                                showPlaybackSessions.set(false);\n                                e.stopImmediatePropagation();\n                            }}\n                        >\n                            <img\n                                class=\"cross-icon\"\n                                src=\"/img/cross-white.svg\"\n                                alt=\"Close playlist sessions modal\"\n                            />\n                        </div>\n                    </div>\n                    <div class=\"playback-sessions-modal-content\">\n                        <PlaybackSessions />\n                    </div>\n                </div>\n            </Modal>\n        </div>\n    );\n}\n"],"names":["queuedTracksCache","playbackSessionsFunc","sessions","setSessions","createSignal","playerState","playbackSessions","audioZoneSession","setAudioZoneSession","createComputed","find","s","sessionId","deleteSession","currentPlaybackSession","setPlayerState","produce","state","filter","newSession","wsService","activateSession","session","queuedTracks","cache","position","tracks","every","t","i","track","playlist","console","error","undefined","trackId","id","slice","length","_el$","_$getNextElement","_tmpl$","_el$2","firstChild","_$createComponent","For","each","children","_el$3","_tmpl$2","_el$4","_el$5","_el$6","nextSibling","_el$7","_el$10","_el$11","_co$","_$getNextMarker","_el$8","_el$12","_el$13","_co$2","_el$16","_el$17","_co$3","_el$18","_el$19","_co$4","_el$14","_el$15","_el$20","_el$21","_el$22","_el$23","_co$5","$$click","name","_$insert","_c$","_$memo","_tmpl$3","_c$2","playing","_tmpl$4","e","stopImmediatePropagation","Index","index","_el$26","_tmpl$5","_el$27","_el$28","_el$29","_el$30","_el$31","Album","album","size","route","title","artist","_c$3","_tmpl$6","_$effect","_$className","_$runHydrationEvents","_$delegateEvents","playbackSessionsModalFunc","onMount","triggerStartup","$showPlaybackSessions","clientSignal","showPlaybackSessions","createNewSession","createSession","playbackTarget","currentPlaybackTarget","Modal","show","onClose","set","PlaybackSessions"],"mappings":"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"}