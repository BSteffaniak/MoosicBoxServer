import{c as y,d as le,b as de,g as j,x as Fe,i as ue,e as qe,f as Me,k as Ve,r as ye,S as Ye,t as te}from"./web.o2PnP_jd.js";/* empty css                        */import{k as g,l as W,d as F,a as d,p as r,c as He,Q as Ke,A as E,m as Ge,n as b,q as O,r as se,u,v as pe,w as ze}from"./api.DZqBGp_p.js";g(!0,"navigationBarExpanded");const Qt=g(!1),Bt=g(!1),Wt=g(!1),I=g(!1),H=g(!1);window.startupCallbacks=window.startupCallbacks??[];function fe(){return window.startupCallbacks||(window.startupCallbacks=[]),window.startupCallbacks}window.startedUp=window.startedUp??!1;function ke(){return window.startedUp===!0}function je(e){window.startedUp=e}async function q(e){if(ke()){try{await e()}catch(t){console.error("Startup error:",t)}return}fe().push(e)}async function Ft(){if(!ke()){je(!0);for(const e of fe())try{await e()}catch(t){console.error("Startup error:",t)}}}const[ge,Je]=W({connections:[],connection:void 0}),[qt,Mt]=y(),[Vt,Yt]=y();F.listen((e,t)=>{e&&(e.token!==t?.token||e.clientId!==t?.clientId)&&d.refetchSignatureToken()});q(async()=>{const e=F.get();if(e&&e.token&&e.clientId)try{await d.validateSignatureToken()}catch(t){console.debug("Failed to validateSignatureToken:",t)}});q(async()=>{const e=await d.getAudioZones();x(r(t=>{t.audioZones=e.items;const s=Q();if(s?.type==="AUDIO_ZONE"){const n=t.audioZones.find(a=>a.id===s.audioZoneId);n&&(t.currentAudioZone=n)}!t.currentAudioZone&&!Q()&&(t.currentAudioZone=t.audioZones[0],t.currentAudioZone&&dt({type:"AUDIO_ZONE",audioZoneId:t.currentAudioZone.id}))}))});var Xe=te("<div class=moosicbox-modal-container><div>");function et(e){return de(Ye,{get when(){return e.show()},children:t=>(()=>{var s=j(Xe),n=s.firstChild;return Fe(s,"click",e.onClose),n.$$click=a=>a.stopPropagation(),ue(n,(()=>{var a=qe(()=>typeof e.children=="function");return()=>a()?e.children(t()):e.children})()),Me(()=>Ve(n,`moosicbox-modal${e.class?` ${e.class}`:""}`)),ye(),s})()})}le(["click"]);var tt=te('<div class=change-playback-target-modal-container><div class=change-playback-target-modal-header><h1>Confirm</h1><div class=change-playback-target-modal-close><img class=cross-icon src=/img/cross-white.svg alt="Close change playback target modal"></div></div><div class=change-playback-target-modal-content>Change playback target?<button class="remove-button-styles change-playback-target-modal-confirmation-button"type=button>yes</button><button class="remove-button-styles change-playback-target-modal-confirmation-button"type=button>no'),st=te("<div data-turbo-permanent id=change-playback-target-modal>");let _=[];async function nt(){return new Promise(e=>{_.push(e)})}function Ht(){const[e]=He(I);return(()=>{var t=j(st);return ue(t,de(et,{show:()=>e(),onClose:()=>I.set(!1),get children(){var s=j(tt),n=s.firstChild,a=n.firstChild,o=a.nextSibling,i=n.nextSibling,S=i.firstChild,m=S.nextSibling,U=m.nextSibling;return o.$$click=c=>{I.set(!1),c.stopImmediatePropagation()},m.$$click=c=>{_.forEach(C=>C(!0)),_=[],I.set(!1),c.stopImmediatePropagation()},U.$$click=c=>{_.forEach(C=>C(!1)),_=[],I.set(!1),c.stopImmediatePropagation()},ye(),s}})),t})()}le(["click"]);let M=!1,w;function at(){console.debug("initSilence");const e=new Ke({duration:"5",format:E.AudioFormat.MP3}),t=Ge(),s=t.clientId,n=E.signatureToken();t.clientId&&n&&(e.set("clientId",s),e.set("signature",n)),t.staticToken&&e.set("authorization",t.staticToken);const a=`${t.apiUrl}/files/silence?${e}`;w=new Audio(a),w.loop=!0,w.play(),w.addEventListener("error",o=>{console.error("Failed to start audio:",o.error),M=!1,w=void 0})}function R(){return M||w?.paused===!1}function K(){if(console.debug("startSilence"),R()){console.debug("startSilence: already playing");return}M=!0,at()}function ot(){if(console.debug("stopSilence"),M=!1,!R()){console.debug("stopSilence: already not playing");return}}const[k,x]=W({playing:!1,currentPlaybackSession:void 0,playbackSessions:[],currentAudioZone:void 0,audioZones:[],currentTrack:void 0}),[be,it]=b(y({format:E.AudioFormat.SOURCE},{equals:!1}),{name:"player.v1.playbackQuality"}),ct=u(),Se=be,Kt=(e,t=!0)=>{const s=be();typeof e=="function"&&(e=e(s)),it(e),t&&e!==s&&ct.trigger(e,s),l({quality:e})},[me,rt]=b(y(void 0,{equals:!1}),{name:"player.v1.currentPlaybackTarget"}),lt=u(),Q=me,dt=(e,t=!0)=>{const s=me();typeof e=="function"&&(e=e(s)),rt(e),t&&e!==s&&lt.trigger(e,s),l({})},[J,ut]=b(y(void 0,{equals:!1}),{name:"player.v1.currentPlaybackSessionId"});y();function Gt(e){console.debug("Setting volume to",e),l({volume:e})}const[Te,V]=b(y(void 0,{equals:!1}),{name:"player.v1.currentSeek"}),he=u(),yt=he.on,pt=Te,zt=(e,t=!0)=>{const s=Te();typeof e=="function"&&(e=e(s)),V(e),t&&e!==s&&he.trigger(e,s)},[Ie,ft]=b(y(0,{equals:!1}),{name:"player.v1.currentTrackLength"}),kt=u(),we=Ie,B=(e,t=!0)=>{const s=Ie();typeof e=="function"&&(e=e(s)),ft(e),t&&e!==s&&kt.trigger(e,s)},[jt,Pe]=b(y(void 0,{equals:!1}),{name:"player.v2.currentAlbum"}),[gt,Ee]=b(y(void 0,{equals:!1}),{name:"player.v1.playlistPosition"}),p=gt,[bt,Ce]=b(y([],{equals:!1}),{name:"player.v1.playlist"}),ne=bt;function Ne(e){const t=Ae(e);if(console.debug("isMasterPlayer:","zone:",e,"players:",T,"activeZonePlayers:",t),t.length===0)return console.debug("isMasterPlayer: no active zone players"),!1;const s=t[0];return e?.players.findIndex(n=>n.playerId===s?.id)!==0?(console.debug("isMasterPlayer: player is not first"),!1):(console.debug("isMasterPlayer: player is master"),!0)}function Ae(e){return console.debug("getActiveZonePlayers: zone =",e,"players =",T),T.filter(t=>e?.players.some(s=>t.id===s.playerId))??[]}function ve(e){return Oe(ge.connection,e).length===1}function Oe(e,t){return console.debug("getActiveConnectionPlayers: connection =",e,"players =",T),e?.connectionId!==t.connectionId?[]:T.filter(s=>e?.players.some(n=>s.id===n.playerId&&n.audioOutputId===t.outputId))??[]}async function G(){console.debug("Play called"),await l({playing:!0})}const ae=u(),Jt=ae.on,Xt=ae.off;async function X(e,t=!1){console.debug("Seek called"),typeof e=="number"&&t&&(console.debug(`Setting seek to ${e}`),await l({play:Re(),seek:e})),ae.trigger(e,t)}async function ce(){console.debug("Pause called"),await l({playing:!1})}const _e=u(),es=_e.on,ts=_e.off;async function St(){if(p()===0)console.debug("Setting track position to 0"),X(0,!0);else if((pt()??0)<5){console.debug("Playing previous track");const e=p()??0;await l({play:!0,seek:0,position:e>0?e-1:e})}else console.debug("Setting track position to 0"),X(0,!0);return!1}const $e=u(),ss=$e.on,ns=$e.off;async function mt(){if(typeof p()=="number"&&p()<ne().length-1){console.debug("Playing next track");const e=p()??0;await l({play:!0,seek:0,position:e+1})}else console.debug("No next track to play"),De();return!1}async function De(){await l({stop:!1})}async function as(e){console.debug("playAlbum",e),Pe(e);const t="type"in e?e.type:"TRACK";switch(t){case"LIBRARY":{e=e;const n=(await d.getAlbumVersions(e.albumId))[0].tracks;await N(n);break}case"TRACK":{e=e;const n=(await d.getAlbumVersions(e.albumId))[0].tracks;await N(n);break}case"TIDAL":{e=e;const n=(await d.getTidalAlbumTracks(e.id)).items;await N(n);break}case"QOBUZ":{e=e;const n=(await d.getQobuzAlbumTracks(e.id)).items;await N(n);break}case"YT":{e=e;const n=(await d.getYtAlbumTracks(e.id)).items;await N(n);break}default:throw new Error(`Invalid album type '${t}'`)}}async function N(e){console.debug("playPlaylist",e);const t=e[0];Pe(t),await l({play:!0,position:0,seek:0,tracks:e,quality:Se()})}async function os(e){console.debug("addAlbumToQueue",e);const t="type"in e?e.type:"TRACK";switch(t){case"LIBRARY":{e=e;const n=(await d.getAlbumVersions(e.albumId))[0].tracks;return A(n)}case"TRACK":{e=e;const n=(await d.getAlbumVersions(e.albumId))[0].tracks;return A(n)}case"TIDAL":{e=e;const n=(await d.getTidalAlbumTracks(e.id)).items;return A(n)}case"QOBUZ":{e=e;const n=(await d.getQobuzAlbumTracks(e.id)).items;return A(n)}case"YT":{e=e;const n=(await d.getYtAlbumTracks(e.id)).items;return A(n)}default:throw new Error(`Invalid album type '${t}'`)}}async function A(e){console.debug("addTracksToQueue",e),l({tracks:[...ne(),...e]})}function is(e){console.debug("Removing track from playlist",e);const t={tracks:[...ne().filter((n,a)=>a!==e)]},s=p();e<s?t.position=s-1:e===s&&(t.seek=0,t.play=!0),l(t)}function cs(e){console.debug("Playing from playlist position",e),l({play:!0,position:e,seek:0})}const T=[];function rs(e){if(T.find(t=>t.id===e.id)){console.debug("Player already registered",e);return}console.debug("Registering player",e),T.push(e)}function Tt(e){const t=e.playbackTarget,s=t.type;switch(s){case"AUDIO_ZONE":if(!Ne(k.audioZones.find(o=>o.id===t.audioZoneId))){ee(e),console.debug("Not master player. Returning");return}break;case"CONNECTION_OUTPUT":if(!ve(t)){ee(e),console.debug("Not active connection player. Returning");return}break;default:throw new Error(`Invalid playbackTargetType: '${s}'`)}const a={sessionId:e.sessionId,playbackTarget:t};for(const[o,i]of se(e,["play","stop","playing","playlist","position","seek","volume"]))if(!(typeof i>"u"))switch(o){case"play":a.play=i;break;case"stop":a.stop=i;break;case"playing":a.playing=i;break;case"playlist":a.tracks=i?.tracks;break;case"position":a.position=i;break;case"seek":a.seek=i;break;case"volume":a.volume=i;break;case"quality":a.quality=i;break}l(a,!1)}async function ht(){return I.set(!0),new Promise(async e=>{e(await nt())})}async function l(e,t=!0){e.quality||(e.quality=Se());const s=e,n=s.sessionId??J(),a=k.playbackSessions.find(c=>c.sessionId===n);let o=s.playbackTarget;const i=Q();let S=!1;if(a&&(o=a.playbackTarget,i&&!O(i,a.playbackTarget)&&!a.playing&&(e.playing||e.play)&&await ht()&&(S=!0)),S&&i&&(o=i),t){const c={sessionId:n,playbackTarget:o};for(const[C,f]of se(e,["play","playing","position","seek","volume","tracks","quality"]))if(!(typeof f>"u"))switch(C){case"play":c.play=f,e.play&&(c.playing=!0);break;case"stop":c.stop=f;break;case"playing":c.playing=f;break;case"position":c.position=f;break;case"seek":c.seek=f;break;case"volume":c.volume=f;break;case"tracks":c.playlist={tracks:f};break;case"quality":c.quality=f;break}wt(n,c)}const m=[],U=o.type;switch(U){case"AUDIO_ZONE":m.push(...Ae(k.audioZones.find(({id:c})=>c===o.audioZoneId)));break;case"CONNECTION_OUTPUT":m.push(...Oe(ge.connection,o));break;default:throw new Error(`Invalid playbackTargetType: '${U}'`)}console.debug("activePlayers:",m),await It(m,{...e,sessionId:n,playbackTarget:o})}async function It(e,t){e.length===0?ee(t):ot(),await Promise.all(e.map(s=>s.updatePlayback(t)))}function ee(e){for(const[s,n]of se(e,["stop","volume","seek","play","tracks","position","playing","quality"]))if(!(typeof n>"u"))switch(s){case"stop":if(e.play||e.playing)continue;navigator.mediaSession&&(navigator.mediaSession.playbackState="paused");break;case"playing":if(e.play)continue;if(navigator.mediaSession&&(navigator.mediaSession.playbackState=e.playing?"playing":"paused"),e.playing)return K();break;case"play":if(!R())return K();navigator.mediaSession&&(navigator.mediaSession.playbackState="playing");break;case"seek":typeof e.seek=="number"&&navigator.mediaSession?.setPositionState({position:e.seek,duration:we()});break}if(k.playbackSessions.find(s=>s.sessionId===e.sessionId)?.playing&&!R())return K()}function wt(e,t){console.debug("updatePlaybackSession:",e,t),x(r(s=>{const n=s.currentPlaybackSession,a=n?.sessionId===e?n:s.playbackSessions.find(o=>o.sessionId===e);if(a){const{playlist:o}=a;o&&t.playlist&&(t.playlist.sessionPlaylistId=o.sessionPlaylistId),Ze(s,t);const i={...t,playlist:void 0};t.playlist?(i.playlist={...t.playlist,sessionPlaylistId:t.playlist.sessionPlaylistId,tracks:t.playlist.tracks.map(pe)},console.debug("updatePlaybackSession: playlist:",i.playlist)):delete i.playlist,Y.updateSession(i)}}))}const Ue=u(),Pt=Ue.on,Le=u(),Et=Le.on;function Ze(e,t){if(e.playbackSessions.forEach(s=>{s.sessionId===t.sessionId&&Object.assign(s,t)}),e.currentPlaybackSession?.sessionId===t.sessionId){Object.assign(e.currentPlaybackSession,t);let s=!1;if(typeof t.seek<"u"&&V(t.seek),typeof t.position<"u"&&(Ee(t.position),s=!0),typeof t.playlist<"u"&&(Ce(t.playlist.tracks),s=!0),s)if(typeof p()=="number"){const n=e.currentPlaybackSession.playlist.tracks[p()];n&&(e.currentTrack=n,B(Math.round(n.duration)))}else e.currentTrack=void 0,B(0)}Le.trigger(t)}function z(e,t,s=!1){if(e.playbackSessions.forEach(n=>{n.sessionId===t.sessionId&&Object.assign(n,t)}),s||t.sessionId===e.currentPlaybackSession?.sessionId){const n=e.currentPlaybackSession;if(e.currentPlaybackSession=t,ut(t.sessionId),console.debug("session changed to",t,"from",n),Ce(t.playlist.tracks),V(t.seek),Ee(t.playlist.tracks.length>0?t.position:void 0),typeof p()=="number"){const a=t.playlist.tracks[p()];a&&(e.currentTrack=a,B(Math.round(a.duration)))}else e.currentTrack=void 0,B(0);Ue.trigger(t,n)}}yt((e,t)=>{console.debug("current seek changed from",t,"to",e),typeof e=="number"&&navigator.mediaSession?.setPositionState({position:e,duration:we()});const s=k.audioZones.some(a=>Ne(a)),n=Q();(s||n?.type==="CONNECTION_OUTPUT"&&ve(n))&&l({seek:e??0})});Et(e=>{k.currentPlaybackSession?.sessionId===e.sessionId&&typeof e.seek<"u"&&V(e.seek)});function Re(){return k.currentPlaybackSession?.playing??!1}navigator?.mediaSession&&(Pt(e=>{navigator.mediaSession.playbackState=e?.playing?"playing":"paused",console.debug("updated playback state to",navigator.mediaSession.playbackState)}),navigator.mediaSession.setActionHandler("play",()=>{console.log("mediaSession: play"),G()}),navigator.mediaSession.setActionHandler("pause",()=>{console.log("mediaSession: pause"),navigator.mediaSession.playbackState==="playing"?ce():G()}),navigator.mediaSession.setActionHandler("stop",()=>{console.log("mediaSession: stop"),De()}),navigator.mediaSession.setActionHandler("nexttrack",()=>{console.log("mediaSession: nexttrack"),mt()}),navigator.mediaSession.setActionHandler("previoustrack",()=>{console.log("mediaSession: previoustrack"),St()})),document.body.onkeydown=function(e){!(e.target instanceof HTMLInputElement)&&(e.key==" "||e.code=="Space")&&(k.currentPlaybackSession?.playing||Re()?ce():G(),e.preventDefault())};const xe=u(),Ct=xe.on,[ls,$]=W({tasks:[],currentTasks:[],historyTasks:[]});function Nt(e){const t=e.type;switch(t){case"SIZE":$(r(s=>{const n=s.tasks.find(a=>a.id===e.taskId);n&&(n.totalBytes=e.bytes??n.totalBytes)}));break;case"BYTES_READ":$(r(s=>{const n=s.tasks.find(a=>a.id===e.taskId);n&&(n.bytes=e.total,n.progress=e.total/n.totalBytes*100)}));break;case"SPEED":$(r(s=>{const n=s.tasks.find(a=>a.id===e.taskId);n&&(n.speed=e.bytesPerSecond)}));break;case"STATE":$(r(s=>{const n=s.tasks.find(a=>a.id===e.taskId);if(n){const a=n.state;if(n.state=e.state,P(n.state)&&!P(a)){const o=s.historyTasks.indexOf(n);o!==-1&&s.historyTasks.splice(o,1),s.currentTasks.unshift(n)}else if(!P(n.state)&&P(a)){const o=s.currentTasks.indexOf(n);o!==-1&&s.currentTasks.splice(o,1),s.historyTasks.unshift(n)}n.state==="FINISHED"&&(n.progress=100)}}));break;default:throw new Error(`Invalid DownloadEvent type: '${t}'`)}}Ct(Nt);function P(e){return e==="STARTED"||e==="PAUSED"||e==="PENDING"}function At(e){return!P(e)}q(async()=>{const e=await d.getDownloadTasks(),t=e.items.filter(({state:n})=>P(n)),s=e.items.filter(({state:n})=>At(n));$(r(n=>{n.tasks=e.items,n.currentTasks=t,n.historyTasks=s}))});const Qe=u(),vt=Qe.on,[Ot,D]=W({tasks:[]});function _t(e){const t=e.type;switch(t){case"FINISHED":D(r(s=>{const n=s.tasks.find(a=>O(a.task,e.task));n&&(n.scanned=e.scanned,n.total=e.total)})),setTimeout(()=>{D(r(s=>{s.tasks=s.tasks.filter(n=>!O(n.task,e.task))})),Ot.tasks.length===0&&H.set(!1)},5e3);break;case"COUNT":D(r(s=>{const n=s.tasks.find(a=>O(a.task,e.task));n?(n.scanned=e.scanned,n.total=e.total):s.tasks.push({task:e.task,scanned:e.scanned,total:e.total})})),H.set(!0);break;case"SCANNED":D(r(s=>{const n=s.tasks.find(a=>O(a.task,e.task));n?(n.scanned=e.scanned,n.total=e.total):s.tasks.push({task:e.task,scanned:e.scanned,total:e.total})})),H.set(!0);break;default:throw new Error(`Invalid ScanEvent type: '${t}'`)}}vt(_t);q(async()=>{D(r(e=>{e.tasks=[]}))});F.listen(e=>{if(e){if(Be(e.apiUrl,e.clientId,E.signatureToken(),e.staticToken),e.token&&!E.signatureToken()){console.debug("Waiting for signature token");return}Y.reconnect()}});E.onSignatureTokenUpdated(e=>{const t=F.get();if(t){if(Be(t.apiUrl,t.clientId,e,t.staticToken),t.token&&!e){console.debug("Waiting for signature token");return}Y.reconnect()}});function Be(e,t,s,n){if(!e?.startsWith("http"))return;const a=[];t&&a.push(`clientId=${encodeURIComponent(t)}`),s&&a.push(`signature=${encodeURIComponent(s)}`),n&&a.push(`authorization=${encodeURIComponent(n)}`),Z=`ws${e.slice(4)}/ws${a.length>0?`?${a.join("&")}`:""}`}let h,Z;const oe=g("","ws.v1.connectionId"),$t=()=>oe.get(),ds=g("New Connection","ws.v1.connectionName"),We=u(),Dt=We.on;Dt(e=>{$t()||oe.set(e),Y.getSessions()});var Ut=(e=>(e.CONNECTION_ID="CONNECTION_ID",e.SESSIONS="SESSIONS",e.SESSION_UPDATED="SESSION_UPDATED",e.CONNECTIONS="CONNECTIONS",e.SET_SEEK="SET_SEEK",e.DOWNLOAD_EVENT="DOWNLOAD_EVENT",e.SCAN_EVENT="SCAN_EVENT",e))(Ut||{});const ie=u(),us=ie.on,Lt=ie.onFirst;Lt(e=>{switch(console.debug("Received ws message",e),e.type){case"CONNECTION_ID":{const t=e;We.trigger(t.connectionId);break}case"SESSIONS":{const t=e;x(r(s=>{s.playbackSessions=t.payload;const n=t.payload.find(a=>a.sessionId===s.currentPlaybackSession?.sessionId);if(n)z(s,n);else if(typeof J()=="number"){const a=t.payload.find(o=>o.sessionId===J())??t.payload[0];a&&z(s,a,!0)}else z(s,t.payload[0],!0)}));break}case"CONNECTIONS":{const t=e;Je(r(s=>{s.connections=t.payload,s.connection=s.connections.find(n=>n.connectionId===oe.get())}));break}case"SET_SEEK":{const t=e;t.payload.sessionId===k.currentPlaybackSession?.sessionId&&X(t.payload.seek);break}case"DOWNLOAD_EVENT":{const t=e;xe.trigger(t.payload);break}case"SCAN_EVENT":{const t=e;Qe.trigger(t.payload);break}case"SESSION_UPDATED":{const s=e.payload;x(r(n=>{Ze(n,s)})),Tt(s);break}}});const re=-1,L=5e3,v={lastConnectionAttemptTime:0,messageBuffer:[]},Y={ping(){this.send({type:"PING"})},getConnectionId(){this.send({type:"GET_CONNECTION_ID"})},registerConnection(e){this.send({type:"REGISTER_CONNECTION",payload:e})},registerPlayers(e){this.send({type:"REGISTER_PLAYERS",payload:e})},playbackAction(e){this.send({type:"PLAYBACK_ACTION",payload:{action:e}})},createAudioZone(e){this.send({type:"CREATE_AUDIO_ZONE",payload:{...e}})},getSessions(){this.send({type:"GET_SESSIONS"})},activateSession(e){this.updateSession({sessionId:e,active:!0})},createSession(e){this.send({type:"CREATE_SESSION",payload:{...e,playlist:{...e.playlist,tracks:e.playlist.tracks.map(pe)}}})},updateSession(e){const t={...e,playlist:void 0};e.playlist?t.playlist={...e.playlist}:delete t.playlist,this.send({type:"UPDATE_SESSION",payload:t})},deleteSession(e){this.send({type:"DELETE_SESSION",payload:{sessionId:e}})},send(e){h?(console.debug("Sending WebSocket message",e),h.send(JSON.stringify(e))):(console.debug("Adding WebSocket message to buffer",e),v.messageBuffer.push(e))},newClient(){return new Promise((e,t)=>{console.log("connecting to ",Z);const s=new WebSocket(Z);let n,a=!1;s.addEventListener("error",o=>{console.error("WebSocket client error",o),a||(s.close(),t())}),s.addEventListener("open",o=>{const i=a;if(a=!0,!i){for(n=setInterval(()=>{if(!a)return clearInterval(n);this.ping()},9*60*1e3),h=s;v.messageBuffer.length>0;){const S=v.messageBuffer.shift();console.debug("Sending buffered WebSocket message",S),h.send(JSON.stringify(S))}this.getConnectionId(),e()}}),s.addEventListener("message",o=>{const i=JSON.parse(o.data);ie.trigger(i)}),s.addEventListener("close",async()=>{if(a){console.debug("Closed WebSocket connection"),a=!1,s.close(),clearInterval(n);const o=Date.now();v.lastConnectionAttemptTime+5e3>o&&(console.debug(`Debouncing connection retry attempt. Waiting ${L}ms`),await this.sleep(L)),v.lastConnectionAttemptTime=o,await this.attemptConnection()}else t()})})},async sleep(e){return new Promise(t=>{setTimeout(t,e)})},async attemptConnection(){let e=0;for(;;){console.debug(`Attempting connection${e>0?`, Attempt ${e+1}`:""}`);try{await this.newClient(),console.debug("Successfully connected client");return}catch(t){if(e++===re&&re!==-1)break;console.error(`WebSocket connection failed at '${Z}':`,ze(t)),console.debug(`Failed to connect. Waiting ${L}ms`),await this.sleep(L)}}throw new Error("Failed to establish connection to websocket server")},reconnect(){return h&&h.close(),this.attemptConnection()}};export{rs as $,Se as A,Kt as B,et as C,x as D,z as E,Y as F,Ft as G,Q as H,oe as I,ge as J,dt as K,N as L,A as M,Vt as N,Yt as O,qt as P,Mt as Q,as as R,os as S,B as T,Ne as U,zt as V,p as W,us as X,Ut as Y,Dt as Z,K as _,Ot as a,Ht as a0,cs as b,ds as c,ls as d,Re as e,ne as f,Gt as g,pt as h,Xt as i,ns as j,ts as k,we as l,X as m,St as n,Jt as o,k as p,ce as q,is as r,H as s,G as t,mt as u,Qt as v,Bt as w,Wt as x,ss as y,es as z};
//# sourceMappingURL=ChangePlaybackTargetModal.BU1Vz2Zf.js.map
